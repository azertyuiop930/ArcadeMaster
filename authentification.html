<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ArcadeMaster - Compte</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Styles sp√©cifiques au compte */
        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #282828;
            border-radius: 8px;
        }
        #profile-pdp {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #00ff00;
            margin-bottom: 10px;
        }
        .role-tag {
            background-color: #00ff00;
            color: #222;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 5px;
        }
        .auth-form h2 {
            margin-top: 0;
            color: #ccc;
            border-bottom: 1px dashed #555;
            padding-bottom: 10px;
        }
        #pdp-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #555;
        }
    </style>
</head>
<body>
    
    <div id="navbar">
        <div class="hamburger-menu" onclick="toggleMenu(this)">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div id="auth-controls">
            </div>
    </div>

    <div id="sidebar">
        <a href="index.html">üè† Accueil</a>
        <a href="jeux.html">üïπÔ∏è Menu Jeux</a>
        <a href="credits.html">üìù Cr√©dits</a>
        <a href="classement.html">üèÜ Classement</a>
        </div>

    <div class="auth-container">
        <div id="auth-content">
            </div>
    </div>
    
    <script src="auth.js"></script>
    <script>
        // --- Logique du Menu Hamburger ---
        function toggleMenu(x) {
            x.classList.toggle("change");
            const sidebar = document.getElementById("sidebar");
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
        
        // --- Logique de la page d'authentification ---
        
        const authContent = document.getElementById('auth-content');
        const DEFAULT_PDP_URL_DISPLAY = 'https://i.imgur.com/39hN7hG.png'; // Doit correspondre √† auth.js

        function renderAccountPage() {
            const currentUser = getCurrentUser();
            
            if (currentUser) {
                const userData = getUserData(currentUser);
                const pdpUrl = userData ? userData.pdp || DEFAULT_PDP_URL_DISPLAY : DEFAULT_PDP_URL_DISPLAY;
                const roleTag = isAdmin(currentUser) ? '<span class="role-tag">üõ°Ô∏è ADMIN</span>' : '<span class="role-tag">Joueur</span>';
                
                // √âcran de gestion du compte (Connect√©)
                authContent.innerHTML = `
                    <h1>Espace Compte</h1>
                    <div class="profile-section">
                        <img src="${pdpUrl}" alt="Photo de Profil" id="profile-pdp">
                        <p>Connect√© en tant que: <strong style="color: #00ff00;">${currentUser}</strong></p>
                        ${roleTag}
                    </div>

                    <div id="account-form" class="auth-form">
                        <h2>Changer le Mot de Passe</h2>
                        <input type="password" id="current-password" placeholder="Mot de passe actuel" required>
                        <input type="password" id="new-password" placeholder="Nouveau mot de passe" required>
                        <button onclick="handleChangePassword()">Changer le Mot de Passe</button>
                        
                        <div id="pdp-form">
                            <h2>Changer la Photo de Profil (URL)</h2>
                            <input type="text" id="pdp-url" value="${pdpUrl}" placeholder="URL de la nouvelle photo" required>
                            <button onclick="handleChangePDP()">Mettre √† jour la PDP</button>
                        </div>

                        <button style="background-color: #e74c3c;" onclick="logout()">D√©connexion</button>
                    </div>
                `;
                
            } else {
                // √âcran de Connexion/Inscription (D√©connect√©)
                renderAuthForm(true); // Afficher la connexion par d√©faut
            }
        }

        function renderAuthForm(isLogin) {
            authContent.innerHTML = `
                <h1>${isLogin ? 'Connexion' : 'Inscription'}</h1>
                <form class="auth-form" onsubmit="event.preventDefault(); ${isLogin ? 'handleLogin(event)' : 'handleRegister(event)'};">
                    <input type="text" id="username" placeholder="Pseudo" required>
                    <input type="password" id="password" placeholder="Mot de passe" required>
                    ${isLogin ? '' : '<input type="password" id="confirm-password" placeholder="Confirmer le mot de passe" required>'}
                    <button type="submit">${isLogin ? 'Se Connecter' : 'S\'inscrire'}</button>
                </form>
                <p class="message" onclick="renderAuthForm(${!isLogin})">
                    ${isLogin ? 'Pas encore de compte ? S\'inscrire' : 'D√©j√† un compte ? Se connecter'}
                </p>
            `;
        }
        
        function handleRegister(event) {
            const username = event.target.elements['username'].value.trim();
            const password = event.target.elements['password'].value;
            const confirmPassword = event.target.elements['confirm-password'].value;
            
            if (!username || !password || !confirmPassword) return alert("Veuillez remplir tous les champs.");
            if (password !== confirmPassword) return alert("Les mots de passe ne correspondent pas.");
            
            const users = loadUsers();
            if (users[username]) return alert("Ce pseudo existe d√©j√†. Veuillez vous connecter.");
            
            // Initialisation avec la PDP par d√©faut
            users[username] = { 
                password: password, 
                games: {},
                pdp: DEFAULT_PDP_URL_DISPLAY 
            };
            saveUsers(users);
            
            login(username);
            alert(`Compte "${username}" cr√©√© et connect√© !`);
            window.location.href = 'index.html'; // Rediriger vers l'accueil apr√®s l'inscription
        }

        function handleLogin(event) {
            const username = event.target.elements['username'].value.trim();
            const password = event.target.elements['password'].value;

            if (!username || !password) return alert("Veuillez remplir tous les champs.");

            const users = loadUsers();
            const user = users[username];

            if (!user || user.password !== password) {
                return alert("Pseudo ou mot de passe incorrect.");
            }

            login(username);
            alert(`Bienvenue, ${username} !`);
            window.location.href = 'index.html'; // Rediriger vers l'accueil apr√®s connexion
        }
        
        function handleChangePassword() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            const currentPass = document.getElementById('current-password').value;
            const newPass = document.getElementById('new-password').value;

            if (!currentPass || !newPass) return alert("Veuillez remplir tous les champs.");
            if (currentPass === newPass) return alert("Le nouveau mot de passe doit √™tre diff√©rent de l'ancien.");

            const users = loadUsers();
            const user = users[currentUser];

            if (user.password !== currentPass) {
                return alert("Mot de passe actuel incorrect.");
            }

            if (changePassword(currentUser, newPass)) {
                alert("Mot de passe mis √† jour avec succ√®s !");
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
            }
        }
        
        function handleChangePDP() {
            const currentUser = getCurrentUser();
            const newUrl = document.getElementById('pdp-url').value.trim();
            
            if (!currentUser || !newUrl) return alert("Veuillez fournir une URL de photo de profil valide.");
            
            if (updatePDP(currentUser, newUrl)) {
                alert("Photo de profil mise √† jour avec succ√®s !");
                renderAccountPage(); // Recharge la page pour afficher la nouvelle PDP
                renderAuthControls(); // Met √† jour la navbar
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
             // Assurez-vous que les fonctions d'auth sont disponibles
            if (typeof getCurrentUser !== 'undefined') {
                renderAccountPage();
            } else {
                // D√©lai de s√©curit√© au cas o√π auth.js ne serait pas charg√© instantan√©ment
                setTimeout(renderAccountPage, 100); 
            }
        });
        
        // Rendre les fonctions d'auth accessibles globalement pour le formulaire
        window.handleRegister = handleRegister;
        window.handleLogin = handleLogin;
        window.handleChangePassword = handleChangePassword;
        window.renderAuthForm = renderAuthForm;
        window.handleChangePDP = handleChangePDP;
    </script>
</body>
</html>
