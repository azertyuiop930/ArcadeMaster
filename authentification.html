<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ArcadeMaster - Connexion / Inscription</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Styles sp√©cifiques √† la page d'authentification */
        .auth-container {
            max-width: 400px;
            margin: 80px auto;
            padding: 30px;
            background-color: var(--color-surface);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        .auth-container h1 {
            color: var(--color-primary);
            margin-bottom: 25px;
            font-size: 2em;
        }
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-top: 15px;
        }
        .auth-form input[type="text"],
        .auth-form input[type="password"],
        .auth-form input[type="url"] {
            padding: 12px;
            border: 1px solid #555;
            border-radius: 5px;
            background-color: #2a2a2a;
            color: var(--color-text);
            font-size: 1em;
            transition: border-color 0.2s;
        }
        .auth-form input:focus {
            border-color: var(--color-primary);
            outline: none;
        }
        .auth-form button {
            padding: 12px;
            background-color: var(--color-primary);
            color: black;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .auth-form button:hover {
            background-color: var(--color-secondary);
        }
        .message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
            display: none; /* Cach√© par d√©faut */
        }
        .message.error {
            background-color: #e74c3c;
        }
        .message.success {
            background-color: #27ae60;
        }
        .switch-mode {
            margin-top: 20px;
            color: var(--color-text);
            cursor: pointer;
            font-size: 0.9em;
            text-decoration: underline;
        }
        .pdp-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 10px auto;
            border: 3px solid var(--color-primary);
            display: block;
        }
    </style>
    <script>
        function toggleMenu(x) {
            x.classList.toggle("change");
            const sidebar = document.getElementById("sidebar");
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
        
        // --- Fonction de bascule du formulaire ---
        function switchAuthMode(mode) {
            const container = document.getElementById('auth-container');
            const formHTML = document.getElementById('form-content');
            const isLogin = mode === 'login';
            
            if (isLogin) {
                container.querySelector('h1').textContent = 'Se Connecter';
                formHTML.innerHTML = `
                    <form id="login-form" onsubmit="handleLogin(event)">
                        <input type="text" id="login-username" placeholder="Nom d'utilisateur" required autocomplete="username">
                        <input type="password" id="login-password" placeholder="Mot de passe" required autocomplete="current-password">
                        <button type="submit">Connexion</button>
                    </form>
                `;
                document.getElementById('switch-mode-button').textContent = "Pas de compte ? S'inscrire ici.";
                document.getElementById('switch-mode-button').onclick = () => switchAuthMode('register');
            } else {
                container.querySelector('h1').textContent = 'Cr√©er un Compte';
                formHTML.innerHTML = `
                    <form id="register-form" onsubmit="handleRegister(event)">
                        <input type="text" id="register-username" placeholder="Nom d'utilisateur" required autocomplete="username">
                        <input type="password" id="register-password" placeholder="Mot de passe (min 5 caract√®res)" required minlength="5" autocomplete="new-password">
                        <input type="url" id="register-pdp" placeholder="URL Image de Profil (Optionnel)" oninput="previewPdp(this.value)">
                        <img id="pdp-preview" class="pdp-preview" src="https://i.imgur.com/39hN7hG.png" alt="Aper√ßu PDP" style="display:none;">
                        <button type="submit">Inscription</button>
                    </form>
                `;
                document.getElementById('switch-mode-button').textContent = "D√©j√† un compte ? Se connecter ici.";
                document.getElementById('switch-mode-button').onclick = () => switchAuthMode('login');
            }
            hideMessage();
        }
        
        // --- Fonction d'aper√ßu PDP ---
        function previewPdp(url) {
            const img = document.getElementById('pdp-preview');
            if (url) {
                img.src = url;
                img.style.display = 'block';
            } else {
                img.style.display = 'none';
                img.src = 'https://i.imgur.com/39hN7hG.png'; 
            }
        }

        // --- Afficher les messages (Erreur/Succ√®s) ---
        function showMessage(type, text) {
            const msg = document.getElementById('message');
            msg.className = `message ${type}`;
            msg.textContent = text;
            msg.style.display = 'block';
        }
        function hideMessage() {
            document.getElementById('message').style.display = 'none';
        }

        // --- GESTIONNAIRE DE CONNEXION ---
        function handleLogin(event) {
            event.preventDefault();
            hideMessage();

            // V√©rifie que les fonctions de auth.js sont charg√©es
            if (typeof login !== 'function') {
                showMessage('error', "Erreur: Le script d'authentification (auth.js) n'est pas charg√©.");
                return;
            }

            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (login(username, password)) {
                showMessage('success', `Connexion r√©ussie ! Redirection en cours...`);
                // D√©lai pour que l'utilisateur voie le message de succ√®s
                setTimeout(() => {
                    window.location.href = 'index.html'; 
                }, 1500);
            } else {
                showMessage('error', 'Nom d\'utilisateur ou mot de passe incorrect.');
            }
        }

        // --- GESTIONNAIRE D'INSCRIPTION ---
        function handleRegister(event) {
            event.preventDefault();
            hideMessage();

            if (typeof registerUser !== 'function') {
                 showMessage('error', "Erreur: Le script d'authentification (auth.js) n'est pas charg√©.");
                 return;
            }

            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const pdp = document.getElementById('register-pdp').value;

            // Simple validation de base
            if (username.length < 3) {
                 showMessage('error', 'Le nom d\'utilisateur doit contenir au moins 3 caract√®res.');
                 return;
            }

            if (registerUser(username, password, pdp)) {
                showMessage('success', `Inscription r√©ussie pour ${username} ! Vous pouvez maintenant vous connecter.`);
                // Basculer automatiquement vers le mode connexion
                setTimeout(() => {
                    switchAuthMode('login');
                }, 1500);
            } else {
                showMessage('error', `Le nom d\'utilisateur "${username}" est d√©j√† pris.`);
            }
        }
    </script>
</head>
<body>
    
    <div id="navbar">
        <div class="hamburger-menu" onclick="toggleMenu(this)">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div id="auth-controls">
            </div>
    </div>

    <div id="sidebar">
        <a href="index.html">üè† Accueil</a>
        <a href="jeux.html">üïπÔ∏è Menu Jeux</a>
        <a href="credits.html">üìù Cr√©dits</a>
        <a href="authentification.html">‚öôÔ∏è Compte</a>
    </div>

    <div class="container">
        <div class="auth-container" id="auth-container">
            <h1>Se Connecter</h1>
            
            <div id="form-content">
                </div>
            
            <div id="message" class="message"></div>
            
            <div id="switch-mode-button" class="switch-mode">
                Pas de compte ? S'inscrire ici.
            </div>
            
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        // Initialisation de la page en mode Connexion
        document.addEventListener('DOMContentLoaded', () => {
             if (typeof renderAuthControls === 'function') {
                 renderAuthControls(); // Met √† jour la navbar
             }
             
             const currentUser = getCurrentUser();
             if (currentUser) {
                 // Si l'utilisateur est d√©j√† connect√©, on affiche un message et on redirige
                 document.getElementById('auth-container').innerHTML = 
                    `<p class="message success" style="display:block;">Vous √™tes d√©j√† connect√©(e) en tant que <strong>${currentUser}</strong>.</p>
                     <p>Redirection vers l'accueil dans 3 secondes...</p>`;
                 setTimeout(() => {
                     window.location.href = 'index.html';
                 }, 3000);
             } else {
                switchAuthMode('login');
             }
        });
    </script>
</body>
</html>
