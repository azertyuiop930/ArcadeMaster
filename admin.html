<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Master - Administration</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        #adminTools {
            background-color: var(--color-card-dark);
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid var(--color-neon-red);
        }
        .tool-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px dashed #444;
        }
        .tool-section h2 {
            color: var(--color-neon-orange);
            text-align: left;
            margin-bottom: 15px;
        }
        /* Styles pour les champs d'admin (plus √©troits que les formulaires normaux) */
        .admin-form-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }
        .admin-form-group input, .admin-form-group select {
            flex-grow: 1;
            padding: 10px;
            border-radius: 5px;
            background-color: #1A1A1A;
            color: var(--color-text-light);
            border: 1px solid #777;
        }
        .admin-form-group button {
            width: auto;
            padding: 10px 20px;
            margin: 0;
        }
        
        /* Liste des utilisateurs */
        #userList {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }
        #userList li {
            background-color: #353535;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>

    <div id="top-bar">
        <div id="menuToggle" class="menu-toggle">
            <i class="fa-solid fa-bars"></i>
        </div>
        <span style="font-size: 1.5em; font-weight: bold; color: var(--color-neon-red);">
            PANEL D'ADMINISTRATION
        </span>
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="boutique.html" class="currency-display" title="Boutique">
                <span class="coin-count">0</span>
                <button id="trollButton" type="button">+</button>
            </a>
            <a href="compte.html" style="color: var(--color-text-light);" title="Mon Compte" data-emoji="üë§">
                üë§
            </a>
        </div>
    </div>

    <div id="sidebar" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" id="closeNav" onclick="closeNav()" style="position: absolute; top: 0; right: 25px; font-size: 36px; color: var(--color-neon-orange);">&times;</a>
        <div id="nav-links">
            <a href="index.html" data-emoji="üè†">üè† Accueil</a>
            <a href="jeux.html" data-emoji="üéÆ">üéÆ Menu Jeux</a>
            <a href="compte.html" data-emoji="üë§">üë§ Mon Compte</a>
            <a href="boutique.html" data-emoji="üõçÔ∏è">üõçÔ∏è Boutique</a>
            <a href="classement.html" data-emoji="üèÜ">üèÜ Classement</a>
            <a href="credits.html" data-emoji="üìú">üìú Cr√©dits</a>
        </div>
    </div>

    <div class="main-container" id="mainContent">
        <div style="padding-top: 50px;"></div> 
        
        <h1 style="font-size: 2em; color: var(--color-neon-red);">ACC√àS ADMINISTRATEUR</h1>
        
        <p id="adminStatus" style="text-align: center; color: var(--color-neon-green);">
            <i class="fa-solid fa-lock"></i> Chargement des privil√®ges...
        </p>
        
        <div id="adminTools" style="display: none;">
            
            <div class="tool-section">
                <h2>1. Gestion des Utilisateurs</h2>
                <div class="admin-form-group">
                    <input type="text" id="usernameSearch" placeholder="Rechercher par Nom d'utilisateur" onkeyup="renderUserList()">
                </div>
                
                <ul id="userList">
                    </ul>
            </div>
            
            <div class="tool-section">
                <h2>2. Modification de Compte</h2>
                <div class="admin-form-group">
                    <input type="text" id="targetUsername" placeholder="Nom d'utilisateur √† modifier" required>
                </div>
                <div class="admin-form-group">
                    <input type="number" id="coinAmount" placeholder="Montant Pi√®ces (ex: 500)" min="-99999" required>
                    <button onclick="addCoins()">Ajouter/Retirer Pi√®ces</button>
                </div>
                <div class="admin-form-group">
                    <input type="number" id="scoreAmount" placeholder="Score Max (ex: 1200)" min="0" required>
                    <select id="gameSelect">
                        <option value="space_invaders">Space Invaders 2.0</option>
                    </select>
                    <button onclick="setHighScore()">D√©finir High Score</button>
                </div>
                <div class="admin-form-group">
                    <select id="roleSelect">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                    <button onclick="setRole()">D√©finir R√¥le</button>
                </div>
                <div class="admin-form-group">
                    <button onclick="deleteUser()" style="background-color: var(--color-neon-red);">Supprimer D√©finitivement (simul√©)</button>
                </div>
            </div>
            
        </div>
    </div>
    
    <script src="base.js"></script>
    <script src="auth.js"></script>
    <script>
        
        function checkAdminAccess() {
            const currentUser = getCurrentUser();
            const adminStatus = document.getElementById('adminStatus');
            const adminTools = document.getElementById('adminTools');

            if (!currentUser || currentUser.role !== 'admin') {
                adminStatus.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Acc√®s refus√©. Vous devez √™tre connect√© en tant qu\'administrateur.';
                adminStatus.style.color = 'var(--color-neon-red)';
                adminTools.style.display = 'none';
            } else {
                adminStatus.innerHTML = `<i class="fa-solid fa-lock-open"></i> Acc√®s Administrateur accord√© √† ${currentUser.username}.`;
                adminStatus.style.color = 'var(--color-neon-green)';
                adminTools.style.display = 'block';
                renderUserList();
            }
        }
        
        // --- TOOL FUNCTIONS ---
        
        function renderUserList() {
            const list = document.getElementById('userList');
            list.innerHTML = '';
            
            const users = loadUsers();
            const searchTerm = document.getElementById('usernameSearch').value.toLowerCase();
            
            users.filter(u => u.username.toLowerCase().includes(searchTerm)).forEach(user => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>
                        <b style="color: ${user.role === 'admin' ? '#FFD700' : 'var(--color-neon-green)'};">${user.username}</b> 
                        (R√¥le: ${user.role.toUpperCase()}) | Pi√®ces: ${user.coins} üí∞
                    </span>
                    <button onclick="document.getElementById('targetUsername').value='${user.username}'" 
                            style="width: auto; padding: 5px 10px; margin: 0; background-color: var(--color-neon-orange); font-size: 0.9em;">
                        Modifier
                    </button>
                `;
                list.appendChild(li);
            });
        }
        
        function getTargetUser() {
            const username = document.getElementById('targetUsername').value;
            const users = loadUsers();
            const user = users.find(u => u.username === username);
            if (!user) {
                alert(`Utilisateur "${username}" non trouv√©.`);
            }
            return user;
        }

        function addCoins() {
            const user = getTargetUser();
            const amount = parseInt(document.getElementById('coinAmount').value);
            
            if (!user || isNaN(amount)) return;
            
            const newCoins = user.coins + amount;
            if (newCoins < 0) {
                 alert("Op√©ration annul√©e : Le solde final ne peut √™tre n√©gatif.");
                 return;
            }
            
            user.coins = newCoins;
            updateGlobalUser(user);
            alert(`Pi√®ces de ${user.username} ajust√©es. Nouveau solde: ${newCoins} üí∞.`);
            renderUserList();
        }
        
        function setHighScore() {
            const user = getTargetUser();
            const score = parseInt(document.getElementById('scoreAmount').value);
            const game = document.getElementById('gameSelect').value;
            
            if (!user || isNaN(score) || score < 0) return;
            
            user.highScores[game] = score;
            updateGlobalUser(user);
            alert(`High Score de ${user.username} pour ${game} mis √† jour √† ${score}.`);
            renderUserList();
        }
        
        function setRole() {
            const user = getTargetUser();
            const role = document.getElementById('roleSelect').value;
            
            if (!user) return;
            
            if (user.username === getCurrentUser().username && role !== 'admin') {
                alert("Erreur: Vous ne pouvez pas vous retirer vous-m√™me le r√¥le d'Admin.");
                return;
            }
            
            user.role = role;
            updateGlobalUser(user);
            alert(`R√¥le de ${user.username} mis √† jour √† ${role.toUpperCase()}.`);
            renderUserList();
        }
        
        function deleteUser() {
             const user = getTargetUser();
             if (!user) return;
             
             if (user.username === getCurrentUser().username) {
                 alert("Op√©ration annul√©e : Vous ne pouvez pas supprimer votre propre compte.");
                 return;
             }
             
             if (confirm(`√ätes-vous s√ªr de vouloir supprimer ${user.username} ? Cette action est irr√©versible (simul√©e).`)) {
                 let users = loadUsers();
                 users = users.filter(u => u.username !== user.username);
                 saveUsers(users);
                 alert(`L'utilisateur ${user.username} a √©t√© supprim√© (du localStorage).`);
                 
                 document.getElementById('targetUsername').value = '';
                 renderUserList();
             }
        }

        document.addEventListener('DOMContentLoaded', checkAdminAccess);

    </script>
</body>
</html>
