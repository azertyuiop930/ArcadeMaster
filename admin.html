<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ArcadeMaster - Administration</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Styles sp√©cifiques au panneau Admin */
        .admin-container {
            padding-top: 100px;
            max-width: 800px; /* Conteneur plus large */
            margin: 0 auto;
            text-align: center;
        }
        h1 {
            color: #00ff00;
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
        }
        #user-list {
            list-style: none;
            padding: 0;
        }
        #user-list li {
            background: #333;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px; /* Espace entre la PDP et le texte */
        }
        .user-name {
            font-weight: bold;
            color: white;
        }
        .admin-role {
            color: yellow;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .admin-actions button {
            background-color: #e74c3c;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        /* La classe .leaderboard-pdp est d√©finie dans styles.css et est utilis√©e ici */
    </style>
</head>
<body>
    
    <div id="navbar">
        <div class="hamburger-menu" onclick="toggleMenu(this)">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div id="auth-controls">
            </div>
    </div>

    <div id="sidebar">
        <a href="index.html">üè† Accueil</a>
        <a href="jeux.html">üïπÔ∏è Menu Jeux</a>
        <a href="credits.html">üìù Cr√©dits</a>
        <a href="authentification.html">‚öôÔ∏è Compte</a>
        </div>

    <div class="admin-container">
        <h1>üõ°Ô∏è Panneau d'Administration</h1>
        <p id="admin-status"></p>
        <ul id="user-list">
            </ul>
    </div>
    
    <script src="auth.js"></script>
    <script>
        // --- Logique du Menu Hamburger ---
        function toggleMenu(x) {
            x.classList.toggle("change");
            const sidebar = document.getElementById("sidebar");
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
        
        const userList = document.getElementById('user-list');
        const adminStatus = document.getElementById('admin-status');
        const DEFAULT_PDP_URL = 'https://i.imgur.com/39hN7hG.png'; // Doit correspondre √† auth.js

        function deleteUser(username) {
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer l'utilisateur : ${username} ? Cette action est irr√©versible.`)) {
                
                if (typeof loadUsers === 'undefined') {
                    alert("Erreur: Les fonctions d'authentification ne sont pas charg√©es.");
                    return;
                }
                
                const users = loadUsers();
                
                // Emp√™cher la suppression de l'utilisateur admin actuel
                if (username === getCurrentUser()) {
                     alert("Erreur: Vous ne pouvez pas supprimer votre propre compte depuis le panneau d'administration.");
                     return;
                }

                if (users[username]) {
                    delete users[username];
                    saveUsers(users);
                    alert(`Utilisateur ${username} supprim√©.`);
                    renderAdminUsers(); // Recharger la liste
                }
            }
        }
        
        function renderAdminUsers() {
            // V√©rification de chargement des fonctions
            if (typeof getCurrentUser === 'undefined' || typeof isAdmin === 'undefined' || typeof loadUsers === 'undefined') {
                 adminStatus.textContent = "Erreur de chargement. V√©rifiez que auth.js est correctement li√©.";
                 return;
            }
            
            const currentUser = getCurrentUser();
            
            if (!currentUser) {
                adminStatus.textContent = "Acc√®s refus√©. Veuillez vous connecter.";
                userList.innerHTML = '';
                return;
            }
            
            // V√©rification de l'acc√®s Admin
            if (!isAdmin(currentUser)) {
                adminStatus.textContent = "Acc√®s refus√©. Vous n'avez pas les droits d'administrateur.";
                userList.innerHTML = '';
                return;
            }
            
            adminStatus.textContent = `Bienvenue, Administrateur ${currentUser}.`;

            const users = loadUsers();
            userList.innerHTML = '';

            for (const username in users) {
                const user = users[username];
                
                // Obtenir l'URL de la PDP
                const pdpUrl = user.pdp || DEFAULT_PDP_URL;
                
                // D√©terminer le r√¥le
                const role = isAdmin(username) ? '<span class="admin-role">(ADMIN)</span>' : '';
                
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <div class="user-info">
                        <img src="${pdpUrl}" alt="PDP" class="leaderboard-pdp">
                        <span class="user-name">${username}</span>
                        ${role}
                    </div>
                    <div class="admin-actions">
                        <button onclick="deleteUser('${username}')">Supprimer</button>
                    </div>
                `;
                userList.appendChild(listItem);
            }
        }

        // Lancement de la v√©rification Admin et du rendu
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof loadUsers !== 'undefined') {
                renderAdminUsers();
            } else {
                setTimeout(renderAdminUsers, 200);
            }
        });
        
        // Rendre la fonction accessible globalement pour les boutons de suppression
        window.deleteUser = deleteUser;
    </script>
</body>
</html>
