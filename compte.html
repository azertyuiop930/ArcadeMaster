<script src="base.js"></script>
<script src="auth.js"></script>
<script>
    // Scripts sp√©cifiques √† la page compte
    
    const authContainer = document.getElementById('authContainer');

    /**
     * Affiche la vue de gestion du profil si l'utilisateur est connect√©.
     * Sinon, laisse les formulaires d'auth et attache les √©couteurs.
     */
    function renderProfileView() {
        const currentUser = getCurrentUser(); // Fonction de auth.js
        
        if (currentUser) {
            authContainer.innerHTML = `
                <div class="auth-card" style="max-width: 500px; text-align: center;">
                    <h2>Bienvenue, ${currentUser.username}!</h2>
                    
                    <div style="margin: 20px 0;">
                        <img id="profilePic" src="${currentUser.profilePic || 'default.png'}" 
                             alt="Photo de profil" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--color-neon-orange);">
                        
                        <p style="color: var(--color-text-light); margin-top: 10px;">
                            R√¥le: <span style="color: ${currentUser.role === 'admin' ? '#FFD700' : 'var(--color-neon-green)'}; font-weight: bold;">${currentUser.role.toUpperCase()}</span>
                        </p>
                        <p class="currency-display" style="justify-content: center; font-size: 1.5em; margin-top: 10px;">
                            <span class="coin-count">${currentUser.coins}</span> Pi√®ces
                        </p>
                    </div>
                    
                    <form id="changePasswordForm">
                        <h3 style="color: var(--color-neon-green); border-bottom: none; margin-top: 30px;">Changer le mot de passe</h3>
                        <label for="newPassword">Nouveau mot de passe</label>
                        <input type="password" id="newPassword" required>
                        <button type="submit" style="background-color: var(--color-neon-orange);">Mettre √† jour le mot de passe</button>
                    </form>
                    
                    <button id="logoutButton" style="background-color: var(--color-neon-red); margin-top: 30px;">
                        D√©connexion
                    </button>
                    
                    <p style="margin-top: 20px;"><a href="boutique.html" style="color: var(--color-neon-green);">üõçÔ∏è Acc√©der √† la boutique de cosm√©tiques</a></p>
                </div>
            `;

            // Attache l'√©couteur de d√©connexion
            document.getElementById('logoutButton').addEventListener('click', logout);
            
            // Attache l'√©couteur de changement de mot de passe
            document.getElementById('changePasswordForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const newPassword = document.getElementById('newPassword').value;
                if (newPassword.length < 4) {
                    alert("Le mot de passe doit contenir au moins 4 caract√®res.");
                    return;
                }
                
                currentUser.password = newPassword;
                updateGlobalUser(currentUser); // Fonction de auth.js
                alert("Mot de passe mis √† jour avec succ√®s !");
                document.getElementById('newPassword').value = '';
            });

            
        } else {
            // Utilisateur d√©connect√© : G√®re les soumissions de formulaires
            
            // 1. Soumission de Connexion
            document.getElementById('loginForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                login(username, password); // Fonction de auth.js
            });

            // 2. Soumission d'Inscription
            document.getElementById('registerForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('registerUsername').value;
                const password = document.getElementById('registerPassword').value;
                register(username, password); // Fonction de auth.js
            });

            // 3. Basculement Connexion/Inscription
            document.getElementById('showRegister').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('loginArea').style.display = 'none';
                document.getElementById('registerArea').style.display = 'block';
            });

            document.getElementById('showLogin').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('registerArea').style.display = 'none';
                document.getElementById('loginArea').style.display = 'block';
            });
        }
    }

    // Ex√©cute la vue appropri√©e au chargement apr√®s un d√©lai minimal pour s'assurer que le DOM est pr√™t
    document.addEventListener('DOMContentLoaded', () => {
        // Le setTimeout assure que m√™me si le DOM est charg√©, le script d'auth a eu le temps de s'ex√©cuter
        setTimeout(renderProfileView, 10); 
    });

</script>
