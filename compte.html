<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Master - Mon Compte</title>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div id="top-bar">
        <div id="menuToggle" class="menu-toggle">
            <i class="fa-solid fa-bars"></i>
        </div>
        <span style="font-size: 1.5em; font-weight: bold; color: var(--color-neon-green);">
            MON COMPTE
        </span>
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="boutique.html" class="currency-display" title="Boutique">
                <span class="coin-count">0</span>
                <button id="trollButton" type="button">+</button>
            </a>
            <a href="compte.html" style="color: var(--color-text-light);" title="Mon Compte" data-emoji="ğŸ‘¤">
                ğŸ‘¤
            </a>
        </div>
    </div>

    <div id="sidebar" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" id="closeNav" onclick="closeNav()" style="position: absolute; top: 0; right: 25px; font-size: 36px; color: var(--color-neon-orange);">&times;</a>
        <div id="nav-links">
            <a href="index.html" data-emoji="ğŸ ">ğŸ  Accueil</a>
            <a href="jeux.html" data-emoji="ğŸ®">ğŸ® Menu Jeux</a>
            <a href="compte.html" data-emoji="ğŸ‘¤">ğŸ‘¤ Mon Compte</a>
            <a href="boutique.html" data-emoji="ğŸ›ï¸">ğŸ›ï¸ Boutique</a>
            <a href="classement.html" data-emoji="ğŸ†">ğŸ† Classement</a>
            <a href="credits.html" data-emoji="ğŸ“œ">ğŸ“œ CrÃ©dits</a>
        </div>
    </div>

    <div class="main-container" id="mainContent">
        <div style="padding-top: 50px;"></div> 
        
        <h1 style="font-size: 2.5em; color: var(--color-neon-orange); text-align: center;">CONNEXION / INSCRIPTION</h1>

        <div id="authContainer">
            </div>

        <div id="profileView" class="auth-card" style="display: none;">
            <h2 style="color: var(--color-neon-green);">Bienvenue, <span id="profileUsername"></span> !</h2>
            
            <div class="stats-card" style="margin-top: 20px;">
                <div class="stat-item">
                    <span>ID Utilisateur</span>
                    <span id="profileID"></span>
                </div>
                <div class="stat-item">
                    <span>PiÃ¨ces ğŸ’°</span>
                    <span id="profileCoins"></span>
                </div>
                <div class="stat-item">
                    <span>Meilleur Score (Invaders) ğŸ†</span>
                    <span id="profileHighScore"></span>
                </div>
                <div class="stat-item">
                    <span>RÃ´le</span>
                    <span id="profileRole"></span>
                </div>
            </div>

            <h3 style="color: var(--color-neon-orange); margin-top: 30px;">Skins Actifs</h3>
            <div id="activeSkins" class="skin-display-group">
                <span class="skin-item">Vaisseau: <b id="activeShip">ğŸš€</b></span>
            </div>

            <button onclick="logoutUser()" class="btn-primary" style="background-color: var(--color-neon-red); margin-top: 30px;">
                Se DÃ©connecter
            </button>
        </div>

        <div id="loginForm" class="auth-card">
            <h2>Se Connecter</h2>
            <form id="loginSubmit">
                <input type="text" id="loginUsername" placeholder="Nom d'utilisateur" required>
                <input type="password" id="loginPassword" placeholder="Mot de passe" required>
                <button type="submit" class="btn-primary">Connexion</button>
            </form>
            <p onclick="showRegister()" style="cursor: pointer; color: var(--color-neon-green); margin-top: 15px;">Pas de compte ? S'inscrire</p>
        </div>

        <div id="registerForm" class="auth-card" style="display: none;">
            <h2>CrÃ©er un Compte</h2>
            <form id="registerSubmit">
                <input type="text" id="registerUsername" placeholder="Nom d'utilisateur" required>
                <input type="password" id="registerPassword" placeholder="Mot de passe" required>
                <button type="submit" class="btn-primary" style="background-color: var(--color-neon-orange);">Inscription</button>
            </form>
            <p onclick="showLogin()" style="cursor: pointer; color: var(--color-neon-green); margin-top: 15px;">DÃ©jÃ  un compte ? Se Connecter</p>
        </div>
        
    </div>
    
    <script src="base.js"></script>
    <script src="auth.js"></script>
    <script>
        // Logique d'affichage des vues
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function renderAccountPage() {
            const user = getCurrentUser();

            if (user) {
                // Vue Profil
                document.getElementById('profileUsername').textContent = user.username;
                document.getElementById('profileID').textContent = user.id;
                document.getElementById('profileCoins').textContent = user.coins;
                document.getElementById('profileHighScore').textContent = user.highScores['space_invaders'] || 0;
                document.getElementById('profileRole').textContent = user.role;
                
                document.getElementById('activeShip').textContent = user.skins.active.ship;

                document.getElementById('profileView').style.display = 'block';
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'none';
            } else {
                // Vue Connexion/Inscription par dÃ©faut
                showLogin();
                document.getElementById('profileView').style.display = 'none';
            }
        }
        
        // Initialisation des listeners et de l'affichage
        document.addEventListener('DOMContentLoaded', () => {
            renderAccountPage();
            
            // Listener de soumission de Connexion
            document.getElementById('loginSubmit').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                if (loginUser(username, password)) {
                    renderAccountPage();
                    updateTopBar(); // Mise Ã  jour de la barre
                }
            });

            // Listener de soumission d'Inscription
            document.getElementById('registerSubmit').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('registerUsername').value;
                const password = document.getElementById('registerPassword').value;
                if (registerUser(username, password)) {
                    renderAccountPage();
                    updateTopBar();
                }
            });
            updateTopBar(); // Appel de la fonction de base pour synchroniser la barre
        });

        window.logoutUser = function() {
            logout();
            renderAccountPage();
            updateTopBar();
        }
    </script>
</body>
</html>
